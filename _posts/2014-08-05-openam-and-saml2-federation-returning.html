---
layout: post
title: 'OpenAM and SAML2 federation : returning a different NameID for each Service
Provider'
date: '2014-08-05T04:17:00.004-07:00'
author: David Hatanian
tags:
- openam
modified_time: '2014-08-05T04:21:05.506-07:00'
thumbnail: http://4.bp.blogspot.com/-_sOrCv8WbBE/U-C1siGCi4I/AAAAAAAAJfI/td1Xa_dNO5E/s72-c/2014-08-05_17-43-31.png
blogger_id: tag:blogger.com,1999:blog-5219665179084602082.post-6398913274945559134
blogger_orig_url: http://david-codes.blogspot.com/2014/08/openam-and-saml2-federation-returning.html
---

<div style="text-align: justify;">If you have an OpenAM identity provider connected to several service providers,
    chances are that not all providers expect the same NameID. Some, like Google Apps, make ask for the user's email
    while others will expect something like ActiveDirectory's sAMAccountName.
</div>
<div style="text-align: justify;"><br/></div>
<div style="text-align: justify;">Now if you're able to map each different NameID to a NameID format in OpenAM,
    everything will work great for you. Here's an example of NameID mapping configuration based on the NameID format :
</div>
<div style="text-align: justify;"><br/></div>
<div class="separator" style="clear: both; text-align: center;"></div>
<div class="separator" style="clear: both; text-align: center;"><a
        href="http://4.bp.blogspot.com/-_sOrCv8WbBE/U-C1siGCi4I/AAAAAAAAJfI/td1Xa_dNO5E/s1600/2014-08-05_17-43-31.png"
        imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0"
                                                                          src="http://4.bp.blogspot.com/-_sOrCv8WbBE/U-C1siGCi4I/AAAAAAAAJfI/td1Xa_dNO5E/s1600/2014-08-05_17-43-31.png"
                                                                          height="180" width="640"/></a></div>
<div style="text-align: justify;"><br/></div>
<div style="text-align: justify;"><br/></div>
<div style="text-align: justify;">But what if you're forced to use the NameId called <i>urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified</i>
    for all your SPs ? This constraint can come from the SPs, but also from your OpenAM installation. In my case OpenAM
    has a read-only user store, so the only NameID formats I am allowed to use are the non-persistent ones. And there
    are only two :
</div><br/>
<ul>
    <li style="text-align: justify;"><i>urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified</i></li>
    <li style="text-align: justify;"><i>urn:oasis:names:tc:SAML:2.0:nameid-format:transient</i></li>
</ul>
<div style="text-align: justify;">And the <i>transient</i>&nbsp;NameID format is not well managed by some SPs, so I am
    stuck with the <i>unspecified</i>&nbsp;format.
</div>
<div style="text-align: justify;"><br/></div>
<div style="text-align: justify;">Luckily, OpenAM provides the ability to inject your own <a
        href="http://openam.forgerock.org/apidocs/com/sun/identity/saml2/plugins/IDPAccountMapper.html">IDPAccountMapper</a>
    implementation. You can inject your custom class directly from the interface like this :
</div>
<div style="text-align: justify;"><br/></div>
<div class="separator" style="clear: both; text-align: center;"></div>
<div class="separator" style="clear: both; text-align: center;"><a
        href="http://2.bp.blogspot.com/-fuZGPtmDCXE/U-C43CVwQeI/AAAAAAAAJfs/XIhqpHGI2Ek/s1600/2014-08-05_17-58-08.png"
        imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0"
                                                                          src="http://2.bp.blogspot.com/-fuZGPtmDCXE/U-C43CVwQeI/AAAAAAAAJfs/XIhqpHGI2Ek/s1600/2014-08-05_17-58-08.png"
                                                                          height="86" width="640"/></a></div>
<div style="text-align: justify;"><br/></div>
<div style="text-align: justify;"><br/></div>
<div style="text-align: justify;">I have decided to keep the mapping used in the administration interface, but to allow
    the user to specify a custom mapping for a given Service Provider. Here's how it looks :
</div>
<div style="text-align: justify;"><br/></div>
<div class="separator" style="clear: both; text-align: center;"><a
        href="http://3.bp.blogspot.com/-Q2lNsfm4SWQ/U-C2UZoG6MI/AAAAAAAAJfQ/RbNOomPBRjk/s1600/2014-08-05_17-46-41.png"
        imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0"
                                                                          src="http://3.bp.blogspot.com/-Q2lNsfm4SWQ/U-C2UZoG6MI/AAAAAAAAJfQ/RbNOomPBRjk/s1600/2014-08-05_17-46-41.png"
                                                                          height="180" width="640"/></a></div>
<div class="separator" style="clear: both; text-align: center;"><br/></div>
<div class="separator" style="clear: both; text-align: justify;">In this example, the <i>unspecified</i>&nbsp;NameID
    format is by default mapped to the <i>mail</i>&nbsp;attribute, unless the SP is <i>https://myserviceprovider.com</i>.
    In that case, the attribute used will be <i>sAMAccountName</i>.
</div>
<div class="separator" style="clear: both; text-align: justify;"><br/></div>
<div class="separator" style="clear: both; text-align: justify;">I will provide the code for this custom&nbsp;<i>IDPAccountMapper</i>.
    But this does not work with most SPs, due to a bug in OpenAM (<a
            href="http://bugster.forgerock.org/jira/browse/OPENAM-4264?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel">OPENAM-4264</a>).
    As far as I know, this bug exists in all versions of OpenAM at this date.
</div>
<div class="separator" style="clear: both; text-align: justify;"><br/></div>
<div class="separator" style="clear: both; text-align: justify;">The problem is that sometimes the SP name is not
    provided to the <i>IDPAccountMapper</i>. To solve this, we need to tweak the <i>AuthnRequest</i> object before it is
    opened by OpenAM to provide the SP name to the <i>IDPAccountMapper</i>.
</div>
<div class="separator" style="clear: both; text-align: justify;"><br/></div>
<div class="separator" style="clear: both; text-align: justify;">For this, we will inject a custom&nbsp;<i>SAML2IdentityProviderAdapter</i>.
    Again we are lucky since OpenAM allows us to inject an object at the right moment.
</div>
<div class="separator" style="clear: both; text-align: justify;"><br/></div>
<div class="separator" style="clear: both; text-align: center;"><a
        href="http://2.bp.blogspot.com/-_8yXW9vVnN8/U-C4qi3vkzI/AAAAAAAAJfk/Z7gzLKxwl88/s1600/2014-08-05_17-56-41.png"
        imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0"
                                                                          src="http://2.bp.blogspot.com/-_8yXW9vVnN8/U-C4qi3vkzI/AAAAAAAAJfk/Z7gzLKxwl88/s1600/2014-08-05_17-56-41.png"
                                                                          height="82" width="640"/></a></div>
<div class="separator" style="clear: both; text-align: center;"><br/></div>
<div class="separator" style="clear: both; text-align: left;">Now here's the source code for the
    <i>IDPAccountMapper </i>and the&nbsp;<i style="text-align: justify;">SAML2IdentityProviderAdapter</i><span
            style="text-align: justify;">&nbsp;:</span></div>
<div style="text-align: justify;"><br/></div>
<pre class="prettyprint">/**<br/> * Copy-paste of the OpenAM DefaultIDPAccountMapper class, with a twist to allow SP-specific configuration.<br/> * To specify a custom attribute for a given SP, use the following mapping : NAMING-FORMAT:SPENTITYID=attribute<br/> * Example : urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified:google.com/a/mycompany.com=mail<br/> */<br/>public class MyIDPAccountMapper extends DefaultAccountMapper implements IDPAccountMapper {<br/>    private DefaultIDPAccountMapper defaultIDPAccountMapperDelegate;<br/><br/>    public MyIDPAccountMapper () {<br/>        debug.message("MyIDPAccountMapper .constructor");<br/>        this.role = "IDPRole";<br/>        defaultIDPAccountMapperDelegate = new DefaultIDPAccountMapper();<br/>    }<br/><br/><br/>    public NameID getNameID(Object session, String hostEntityID, String remoteEntityID, String realm, String nameIDFormat)<br/>            throws SAML2Exception {<br/>        String userID = null;<br/>        try {<br/>            SessionProvider sessionProv = SessionManager.getProvider();<br/>            userID = sessionProv.getPrincipalName(session);<br/>        } catch (SessionException se) {<br/>            throw new SAML2Exception(SAML2Utils.bundle.getString("invalidSSOToken"));<br/>        }<br/><br/><br/>        String nameIDValue = null;<br/>        if (nameIDFormat.equals("urn:oasis:names:tc:SAML:2.0:nameid-format:transient")) {<br/>            String sessionIndex = IDPSSOUtil.getSessionIndex(session);<br/>            if (sessionIndex != null) {<br/>                IDPSession idpSession = (IDPSession) IDPCache.idpSessionsByIndices.get(sessionIndex);<br/><br/>                if (idpSession != null) {<br/>                    List list = idpSession.getNameIDandSPpairs();<br/>                    if ((list != null) &amp;&amp; (!list.isEmpty())) {<br/>                        Iterator iter = list.iterator();<br/>                        while (iter.hasNext()) {<br/>                            NameIDandSPpair pair = (NameIDandSPpair) iter.next();<br/><br/>                            if (pair.getSPEntityID().equals(remoteEntityID)) {<br/>                                nameIDValue = pair.getNameID().getValue();<br/>                                break;<br/>                            }<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>            if (nameIDValue == null) {<br/>                nameIDValue = getNameIDValueFromUserProfile(realm, hostEntityID, remoteEntityID, userID, nameIDFormat);<br/><br/>                if (nameIDValue == null) {<br/>                    nameIDValue = SAML2Utils.createNameIdentifier();<br/>                }<br/>            }<br/>        } else {<br/>            nameIDValue = getNameIDValueFromUserProfile(realm, hostEntityID, remoteEntityID, userID, nameIDFormat);<br/><br/>            if (nameIDValue == null) {<br/>                if (nameIDFormat.equals("urn:oasis:names:tc:SAML:2.0:nameid-format:persistent")) {<br/>                    nameIDValue = SAML2Utils.createNameIdentifier();<br/>                } else {<br/>                    throw new SAML2Exception(bundle.getString("unableToGenerateNameIDValue"));<br/>                }<br/>            }<br/>        }<br/><br/><br/>        NameID nameID = AssertionFactory.getInstance().createNameID();<br/>        nameID.setValue(nameIDValue);<br/>        nameID.setFormat(nameIDFormat);<br/>        nameID.setNameQualifier(hostEntityID);<br/>        nameID.setSPNameQualifier(remoteEntityID);<br/>        nameID.setSPProvidedID(null);<br/>        return nameID;<br/>    }<br/><br/><br/>    public String getIdentity(NameID nameID, String hostEntityID, String remoteEntityID, String realm)<br/>            throws SAML2Exception {<br/>        debug.warning("MyIDPAccountMapper -specific implementation received a call to getIdentity(). This is not supported by this implementation and will be deferred to the DefaultIDPAccountMapper delegate.");<br/>        return defaultIDPAccountMapperDelegate.getIdentity(nameID, hostEntityID, remoteEntityID, realm);<br/>    }<br/><br/><br/>    protected String getNameIDValueFromUserProfile(String realm, String hostEntityID, String remoteEntityID, String userID, String nameIDFormat) {<br/>        if (debug.messageEnabled()) {<br/>            debug.message("Asking NameID for user " + userID + ", nameId format " + nameIDFormat + ", SP entity : " + remoteEntityID);<br/>        }<br/>        String nameIDValue = null;<br/>        Map formatAttrMap = getFormatAttributeMap(realm, hostEntityID);<br/><br/>        String spSpecificNameIDFormat = nameIDFormat + ":" + remoteEntityID;<br/>        String attrName = (String) formatAttrMap.get(spSpecificNameIDFormat);<br/><br/>        if (attrName == null) {<br/>            attrName = (String) formatAttrMap.get(nameIDFormat);<br/>            if (debug.messageEnabled()) {<br/>                debug.message("Could not find a SP-specific attribute name, found generic attribute name : " + attrName);<br/>            }<br/>        } else {<br/>            if (debug.messageEnabled()) {<br/>                debug.message("Found SP-specific attribute name : " + attrName);<br/>            }<br/>        }<br/><br/><br/>        if (attrName != null) {<br/>            try {<br/>                Set attrValues = dsProvider.getAttribute(userID, attrName);<br/>                if ((attrValues != null) &amp;&amp; (!attrValues.isEmpty())) {<br/>                    nameIDValue = (String) attrValues.iterator().next();<br/>                }<br/>            } catch (DataStoreProviderException dspe) {<br/>                if (debug.warningEnabled()) {<br/>                    debug.warning("DefaultIDPAccountMapper.getNameIDValueFromUserProfile:", dspe);<br/>                }<br/>            }<br/>        }<br/><br/><br/>        return nameIDValue;<br/>    }<br/><br/>    private Map getFormatAttributeMap(String realm, String hostEntityID) {<br/>        String key = hostEntityID + "|" + realm;<br/>        Map formatAttributeMap = (Map) IDPCache.formatAttributeHash.get(key);<br/>        if (formatAttributeMap != null) {<br/>            return formatAttributeMap;<br/>        }<br/><br/>        formatAttributeMap = new HashMap();<br/>        List values = SAML2Utils.getAllAttributeValueFromSSOConfig(realm, hostEntityID, this.role, "nameIDFormatMap");<br/>        Iterator iter;<br/>        if ((values != null) &amp;&amp; (!values.isEmpty())) {<br/>            for (iter = values.iterator(); iter.hasNext(); ) {<br/>                String value = (String) iter.next();<br/><br/>                int index = value.indexOf('=');<br/>                if (index != -1) {<br/>                    String format = value.substring(0, index).trim();<br/>                    String attrName = value.substring(index + 1).trim();<br/>                    if ((format.length() != 0) &amp;&amp; (attrName.length() != 0)) {<br/>                        formatAttributeMap.put(format, attrName);<br/>                    }<br/>                }<br/>            }<br/>        }<br/><br/>        IDPCache.formatAttributeHash.put(key, formatAttributeMap);<br/><br/>        return formatAttributeMap;<br/>    }<br/></pre>
<br/><br/><br/>
<pre class="prettyprint">/**<br/> * This class is used as a fix for https://bugster.forgerock.org/jira/browse/OPENAM-4264<br/> * We modify the AuthnRequest parameter so that the IDPSSOUtil class can then find the SP id and provide it to the IDPAccountMapper<br/> */<br/>public class MyAuthRequestUpdatingIDPAdapter extends DefaultIDPAdapter {<br/>    private Debugger saml2UtilsDebugger = new SAML2UtilsDebugger();<br/><br/>    @Override<br/>    public boolean preSendResponse(AuthnRequest authnRequest, String hostProviderID, String realm, HttpServletRequest request, HttpServletResponse response, Object session, String reqID, String relayState) throws SAML2Exception {<br/>        SPNameQualifierEnhancer.addSPNameQualifierToAuthnRequest(authnRequest, saml2UtilsDebugger);<br/>        return super.preSendResponse(authnRequest, hostProviderID, realm, request, response, session, reqID, relayState);<br/>    }<br/>}<br/></pre>This is the class that updates the authentication request to fix our bug :
<br/>
<pre class="prettyprint">public class SPNameQualifierEnhancer {<br/>    private static final String DEBUG_PREFIX = "MyAuthRequestUpdatingIDPAdapter : ";<br/><br/>    public static void addSPNameQualifierToAuthnRequest(AuthnRequest authnRequest, Debugger debug) throws SAML2Exception {<br/>        if (authnRequest instanceof AuthnRequestImpl) {<br/>            MutabilityModifier.makeMutable((AuthnRequestImpl) authnRequest);<br/>            if (authnRequest.getNameIDPolicy() == null) {<br/>                authnRequest.setNameIDPolicy(new NameIDPolicyImpl());<br/>                debug.message(DEBUG_PREFIX + "no NameIDPolicy found in SAML2 authn request, will create a default nameid policy");<br/>            }<br/><br/>            if (!SPNameQualifierChecker.isValidSPNameQualifier(authnRequest.getNameIDPolicy().getSPNameQualifier())) {<br/>                String replacementSpNameQualifier = null;<br/>                if (authnRequest.getIssuer() != null) {<br/>                    replacementSpNameQualifier = authnRequest.getIssuer().getValue();<br/>                }<br/>                authnRequest.setNameIDPolicy(new NameIDPolicyWithSPNameQualifierProxy(authnRequest.getNameIDPolicy(), replacementSpNameQualifier));<br/>                debug.message(DEBUG_PREFIX + "no SPNameQualifier found in SAML2 authn request, will create one with issuer name : " + replacementSpNameQualifier);<br/>            }<br/>        } else {<br/>            debug.warning("Unable to change mutability of class : " + authnRequest.getClass().getCanonicalName());<br/>        }<br/>    }<br/>}<br/></pre>
<br/>
<br/>This class simply checks whether the SPNameQualifier provided in the authentication request is valid, or if we need to insert one :
<br/><br/>
<pre class="prettyprint">public abstract class SPNameQualifierChecker {<br/>    public static boolean isValidSPNameQualifier(String spNameQualifier) {<br/>        return spNameQualifier != null &amp;&amp; !(spNameQualifier.trim().isEmpty());<br/>    }<br/>}<br/></pre>
<br/>
<br/>Since by default the authentication request cannot be modified, we need to tweak it a little bit. Since this implies modifying a
<i>protected</i> attribute, <b>the package declaration is important</b> :  <br/><br/>
<pre class="prettyprint">package com.sun.identity.saml2.protocol.impl;<br/><br/>public class MutabilityModifier {<br/>    public static void makeMutable(AuthnRequestImpl authnRequest) {<br/>        authnRequest.isMutable = true;<br/>    }<br/>}<br/></pre>
<br/><br/>The rest is just boilerplate : <br/><br/>
<pre class="prettyprint">public class NameIDPolicyWithSPNameQualifierProxy implements NameIDPolicy {<br/>    private NameIDPolicy nameIDPolicy;<br/>    private String replacementSPNameQualifier;<br/><br/>    public NameIDPolicyWithSPNameQualifierProxy(NameIDPolicy nameIDPolicy, String replacementSPNameQualifier) {<br/>        this.nameIDPolicy = nameIDPolicy;<br/>        this.replacementSPNameQualifier = replacementSPNameQualifier;<br/>    }<br/><br/>    @Override<br/>    public String getSPNameQualifier() {<br/>        return replacementSPNameQualifier;<br/>    }<br/><br/>    @Override<br/>    public String getFormat() {<br/>        return nameIDPolicy.getFormat();<br/>    }<br/><br/>    @Override<br/>    public void setFormat(String s) throws SAML2Exception {<br/>        nameIDPolicy.setFormat(s);<br/>    }<br/><br/>    @Override<br/>    public void setSPNameQualifier(String s) throws SAML2Exception {<br/>        nameIDPolicy.setSPNameQualifier(s);<br/>    }<br/><br/>    @Override<br/>    public void setAllowCreate(boolean b) throws SAML2Exception {<br/>        nameIDPolicy.setAllowCreate(b);<br/>    }<br/><br/>    @Override<br/>    public boolean isAllowCreate() {<br/>        return nameIDPolicy.isAllowCreate();<br/>    }<br/><br/>    @Override<br/>    public String toXMLString() throws SAML2Exception {<br/>        return nameIDPolicy.toXMLString();<br/>    }<br/><br/>    @Override<br/>    public String toXMLString(boolean b, boolean b2) throws SAML2Exception {<br/>        return nameIDPolicy.toXMLString(b, b2);<br/>    }<br/><br/>    @Override<br/>    public void makeImmutable() {<br/>        nameIDPolicy.makeImmutable();<br/>    }<br/><br/>    @Override<br/>    public boolean isMutable() {<br/>        return nameIDPolicy.isMutable();<br/>    }<br/><br/>}<br/></pre>
<br/>
<pre class="prettyprint">public interface Debugger {<br/>    public void message(String s);<br/>    public void warning(String s);<br/>}<br/></pre>
<br/>
<pre class="prettyprint">public class SAML2UtilsDebugger implements Debugger{<br/>    @Override<br/>    public void message(String s) {<br/>        SAML2Utils.debug.message(s);<br/>    }<br/><br/>    @Override<br/>    public void warning(String s) {<br/>        SAML2Utils.debug.warning(s);<br/>    }<br/>}<br/></pre>
<br/>And the test classes : <br/><br/>
<pre class="prettyprint">public class MyAuthRequestUpdatingIDPAdapterTest{<br/>    private Debugger debugger = new TestDebugger();<br/>    private static final String ISSUER = "theissuer";<br/>    private static final String VALID_QUALIFIER = "thequalifier";<br/><br/>    @Test<br/>    public void testNoNameIDPolicy() throws Exception {<br/>        AuthnRequest authnRequest = new AuthnRequestImpl();<br/>        Issuer issuer = new IssuerImpl();<br/>        issuer.setValue(ISSUER);<br/>        authnRequest.setIssuer(issuer);<br/>        authnRequest.makeImmutable();<br/>        SPNameQualifierEnhancer.addSPNameQualifierToAuthnRequest(authnRequest,debugger );<br/>        assertNotNull(authnRequest.getNameIDPolicy());<br/>        assertEquals(NameIDPolicyWithSPNameQualifierProxy.class, authnRequest.getNameIDPolicy().getClass());<br/>        assertEquals(ISSUER, authnRequest.getNameIDPolicy().getSPNameQualifier());<br/>    }<br/><br/>    @Test<br/>      public void testNoSPNameQualifier() throws Exception {<br/>        AuthnRequest authnRequest = new AuthnRequestImpl();<br/>        Issuer issuer = new IssuerImpl();<br/>        issuer.setValue(ISSUER);<br/>        authnRequest.setIssuer(issuer);<br/><br/>        NameIDPolicy nameIDPolicy = new NameIDPolicyImpl();<br/>        nameIDPolicy.makeImmutable();<br/>        authnRequest.setNameIDPolicy(nameIDPolicy);<br/><br/>        authnRequest.makeImmutable();<br/>        SPNameQualifierEnhancer.addSPNameQualifierToAuthnRequest(authnRequest, debugger);<br/>        assertNotNull(authnRequest.getNameIDPolicy());<br/>        assertEquals(NameIDPolicyWithSPNameQualifierProxy.class, authnRequest.getNameIDPolicy().getClass());<br/>        assertEquals(ISSUER, authnRequest.getNameIDPolicy().getSPNameQualifier());<br/>    }<br/><br/>    @Test<br/>    public void testEmptySPNameQualifier() throws Exception {<br/>        AuthnRequest authnRequest = new AuthnRequestImpl();<br/>        Issuer issuer = new IssuerImpl();<br/>        issuer.setValue(ISSUER);<br/>        authnRequest.setIssuer(issuer);<br/><br/>        NameIDPolicy nameIDPolicy = new NameIDPolicyImpl();<br/>        nameIDPolicy.setSPNameQualifier(" ");<br/>        nameIDPolicy.makeImmutable();<br/>        authnRequest.setNameIDPolicy(nameIDPolicy);<br/><br/>        authnRequest.makeImmutable();<br/>        SPNameQualifierEnhancer.addSPNameQualifierToAuthnRequest(authnRequest, debugger);<br/>        assertNotNull(authnRequest.getNameIDPolicy());<br/>        assertEquals(NameIDPolicyWithSPNameQualifierProxy.class, authnRequest.getNameIDPolicy().getClass());<br/>        assertEquals(ISSUER, authnRequest.getNameIDPolicy().getSPNameQualifier());<br/>    }<br/><br/>    @Test<br/>    public void testValidSPNameQualifier() throws Exception {<br/>        AuthnRequest authnRequest = new AuthnRequestImpl();<br/>        Issuer issuer = new IssuerImpl();<br/>        issuer.setValue(ISSUER);<br/>        authnRequest.setIssuer(issuer);<br/><br/>        NameIDPolicy nameIDPolicy = new NameIDPolicyImpl();<br/>        nameIDPolicy.setSPNameQualifier(VALID_QUALIFIER);<br/>        nameIDPolicy.makeImmutable();<br/>        authnRequest.setNameIDPolicy(nameIDPolicy);<br/><br/>        authnRequest.makeImmutable();<br/>        SPNameQualifierEnhancer.addSPNameQualifierToAuthnRequest(authnRequest, debugger);<br/>        assertNotNull(authnRequest.getNameIDPolicy());<br/>        assertEquals(NameIDPolicyImpl.class, authnRequest.getNameIDPolicy().getClass());<br/>        assertEquals(VALID_QUALIFIER, authnRequest.getNameIDPolicy().getSPNameQualifier());<br/>    }<br/>}<br/></pre>
<br/><br/>
<pre class="prettyprint">public class TestDebugger implements Debugger {<br/><br/>    @Override<br/>    public void message(String s) {<br/>        System.out.println("MESSAGE : "+s);<br/>    }<br/><br/>    @Override<br/>    public void warning(String s) {<br/>        System.out.println("WARNING : "+s);<br/>    }<br/>}<br/></pre>