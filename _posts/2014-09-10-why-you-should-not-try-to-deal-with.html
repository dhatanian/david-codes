---
layout: post
title: Why you should not try to deal with dates manually
author: David Hatanian
tags:
blogger_id: tag:blogger.com,1999:blog-5219665179084602082.post-226740451674924868
blogger_orig_url: http://david-codes.blogspot.com/2014/09/why-you-should-not-try-to-deal-with.html
---

<div style="text-align: justify;">When you're writing a program, you will always have to deal with dates and times at
    one point of the other.
</div>
<div style="text-align: justify;"><br/></div>
<div style="text-align: justify;">It could be because you want to setup a scheduled task, or because you want a feature
    that provides reporting of his last month's activities to the user.
</div>
<div style="text-align: justify;"><br/></div>
<div style="text-align: justify;">Date handling can be very tricky, and a lot of users still try to handle this
    manually. If you read <a href="http://thedailywtf.com/">The Daily WTF</a>, you'll notice that probably a third of
    the poor coding examples have something to do with dates.
</div>
<div style="text-align: justify;"><br/></div>
<div style="text-align: justify;">Microsoft's Azure platform experienced an <a
        href="http://azure.microsoft.com/blog/2012/03/09/summary-of-windows-azure-service-disruption-on-feb-29th-2012/">outage
    last year</a> due to incorrect handling of leap years in 2013.
</div>
<div style="text-align: justify;"><br/></div>
<div style="text-align: justify;">This articles is an attempt to list the gotchas you will encounter working with dates.
    There are two type of tricky aspects in handling dates : the date system itself, with its timezone, leap years and
    daylight saving time; and the technical aspect, that is how our computer systems manage dates.
</div><h2>Timezones and daylight saving time</h2>
<div>
    <div style="text-align: justify;">Aaah timezones... certainly easy to compute, right ? Just a signed <i>int</i>&nbsp;to
        indicate how many hours from UTC to store in the database.
    </div>
    <div style="text-align: justify;"><br/></div>
    <div style="text-align: justify;">But wait, did you know that some timezones have 30 minutes offset as well ? Check
        out Iran (UTC+4:30)&nbsp;or India&nbsp;(UTC+5:30).
    </div>
    <div style="text-align: justify;"><br/></div>
    <div style="text-align: justify;">Countries also change timezones from time to time, usually for economical or
        political purpose, that is to get closer to a partner country or to show distance with a neighbour a bit too
        invasive. <a href="http://www.timeanddate.com/news/time/samoa-dateline.html">Samao switched timezone 3 years
            ago</a> to get closer to Australia.
    </div>
    <div style="text-align: justify;"><br/></div>
    <div style="text-align: justify;">What about daylight saving time ? Did you know that some country change the DST at
        the last minute ? For example, <a
                href="http://www.timeanddate.com/news/time/egypt-morocco-dst-ramadan-2014.html">Morocco has already done
            this quite a couple of times</a>, to prepare for the religious month of Ramaddan. At that time, all our
        clocks on Windows were 1 hour late... If you run a calendar app and provide notification services, your Moroccan
        users probably received the notifications one hour too late during those days.
    </div>
    <h2 style="text-align: justify;">Leap years</h2>

    <div style="text-align: justify;">Enough about country-specific aspects, what about universal aspects of our
        calendar, such as leap years ? In those years, the year counts 366 days instead of the usual 365. Here's how to
        know if you're in a leap year <a href="http://en.wikipedia.org/wiki/Leap_year#Algorithm">according to
            Wikipedia</a> :
    </div>
    <blockquote class="tr_bq" style="text-align: justify;"><b
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">if</b><span
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">&nbsp;(</span><i
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">year</i><span
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">&nbsp;is not divisible by 4)&nbsp;</span><b
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">then</b><span
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">&nbsp;(it is a common year)</span>&nbsp;
    </blockquote>
    <blockquote class="tr_bq" style="text-align: justify;"><b
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">else</b><b
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">if</b><span
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">&nbsp;(</span><i
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">year</i><span
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">&nbsp;is not divisible by 100)&nbsp;</span><b
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">then</b><span
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">&nbsp;(it is a leap year)</span>&nbsp;
    </blockquote>
    <blockquote class="tr_bq" style="text-align: justify;"><b
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">else</b><b
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">if</b><span
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">&nbsp;(</span><i
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">year</i><span
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">&nbsp;is not divisible by 400)&nbsp;</span><b
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">then</b><span
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">&nbsp;(it is a common year)</span>&nbsp;
    </blockquote>
    <blockquote class="tr_bq" style="text-align: justify;"><b
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">else</b><span
            style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; text-align: start;">&nbsp;(it is a leap year)</span>
    </blockquote>
    If Microsoft made the mistake, we can expect others to do it as well.<br/><br/>

    <div style="text-align: justify;">Now, let us say you have circumvented the problem by using a reliable date library
        (more on that later) and good unit testing. You're not done yet because our computer systems make date
        management even trickier...
    </div>
</div><h2>Trusting the user's clock</h2>
<div>If you're developing a rich web application, a mobile application or an old school desktop application, you will
    have to deal with the user's clock.<br/><br/>

    <div style="text-align: justify;">That clock can be improperly set, and your time-sensitive operations might fail
        because of this. Let us say you have a javascript application that can ask a server for data at a certain time.
        To stay in the calendar example, let us imagine that the client code retrieves a list of events for a given set
        of start and end date.
    </div>
    <div style="text-align: justify;"><br/></div>
    <div style="text-align: justify;">If you client's clock is wrong, you will end up requesting the list of events for
        yesterday when the user wants the list for tomorrow.
    </div>
    <div style="text-align: justify;"><br/></div>
    <div style="text-align: justify;">One very time-sensitive type of operations is authentication. A lot of
        authentication protocols use timestamps (OAuth, Kerberos for example) and the authentication will fail if the
        client's clock is set wrong.
    </div>
</div><h2>Parsing and printing
    dates</h2>Did you write any application that does not either parse a date or prints somewhere (screen, name of a file, a web-service) ?
<br/><br/>
<div style="text-align: justify;">Try as much as possible to avoid parsing dates that are locale-dependent. Something
    that is written "Tuesday, September 3rd" might be written "Mardi 3 Septembre" on another machine.
</div><br/>
<div style="text-align: justify;">Also, if you're displaying dates in a user interface, take into account that the
    length of month names depend on the language : July and Juillet are the same month but do not have the same length.
    Beware of text that does not fit and overflows or becomes partly hidden.
</div>
<div style="text-align: justify;"><br/></div>
<div style="text-align: justify;">When parsing/printing a date, do not forget the TimeZone, otherwise you'll be off by
    several hours.
</div>
<div style="text-align: justify;"><br/></div>
<div style="text-align: justify;">My recommendations :</div>
<div style="text-align: justify;"></div>
<ul>
    <li>Use ms or ns since epoch when for technical purposes (web-services, storing in a file etc)</li>
    <li>When you still want the date to be readable by the user, use the <a
            href="http://en.wikipedia.org/wiki/ISO_8601">ISO 8601 format</a> that is easier to parse and alphabetically
        sorted
    </li>
</ul><br/>
<div class="separator" style="clear: both; text-align: center;"><a href="https://imgs.xkcd.com/comics/iso_8601.png"
                                                                   imageanchor="1"
                                                                   style="margin-left: 1em; margin-right: 1em;"><img
        border="0" src="https://imgs.xkcd.com/comics/iso_8601.png"/></a></div><br/><h2>Who will
    save us ?</h2>
<div>In Java, the <i>java.util.Date </i>and <i>java.util.Calendar</i>&nbsp;API is good enough for good for most simple
    uses. The <a href="http://www.joda.org/joda-time">Joda time library</a> gives easiest access to most date and
    time-related operations.<br/><br/>The <a href="http://www.joda.org/joda-time/#Why_Joda-Time">"Why Joda Time"</a>
    section of the above link summarizes the advantages of this library as follows :<br/><br/>
    <blockquote class="tr_bq">
        <ul style="background-color: white; font-family: Helvetica, Arial, sans-serif; font-size: 13px; margin-bottom: 6px; margin-top: 4px;">
            <li><b>Easy to Use</b>. Calendar makes accessing 'normal' dates difficult, due to the lack of simple
                methods. Joda-Time has straightforward&nbsp;<a href="http://www.joda.org/joda-time/field.html"
                                                               style="color: #000099; text-decoration: none;">field
                    accessors</a>&nbsp;such as&nbsp;<tt>getYear()</tt>&nbsp;or&nbsp;<tt>getDayOfWeek()</tt>.
            </li>
            <li><b>Easy to Extend</b>. The JDK supports multiple calendar systems via subclasses
                of&nbsp;<tt>Calendar</tt>. This is clunky, and in practice it is very difficult to write another
                calendar system. Joda-Time supports multiple calendar systems via a pluggable system based on
                the&nbsp;<tt>Chronology</tt>&nbsp;class.
            </li>
            <li><b>Comprehensive Feature Set</b>. The library is intended to provide all the functionality that is
                required for date-time calculations. It already provides out-of-the-box features, such as support for
                oddball date formats, which are difficult to replicate with the JDK.
            </li>
            <li><b>Up-to-date Time Zone calculations</b>. The&nbsp;<a
                    href="http://www.joda.org/joda-time/timezones.html" style="color: #000099; text-decoration: none;">time
                zone implementation</a>&nbsp;is based on the public&nbsp;<a class="externalLink"
                                                                            href="http://www.iana.org/time-zones"
                                                                            style="color: #000099; padding-right: 15px; text-decoration: none;">tz
                database</a>, which is updated several times a year. New Joda-Time releases incorporate all changes made
                to this database. Should the changes be needed earlier,&nbsp;<a
                        href="http://www.joda.org/joda-time/tz_update.html"
                        style="color: #000099; text-decoration: none;">manually updating the zone data</a>&nbsp;is easy.
            </li>
            <li><b>Calendar support</b>. The library currently provides 8 calendar systems. More will be added in the
                future.
            </li>
            <li><b>Easy interoperability</b>. The library internally uses a millisecond instant which is identical to
                the JDK and similar to other common time representations. This makes interoperability easy, and
                Joda-Time comes with out-of-the-box JDK interoperability.
            </li>
            <li><b>Better Performance Characteristics</b>. Calendar has strange performance characteristics as it
                recalculates fields at unexpected moments. Joda-Time does only the minimal calculation for the field
                that is being accessed.
            </li>
            <li><b>Good Test Coverage</b>. Joda-Time has a comprehensive set of developer tests, providing assurance of
                the library's quality.
            </li>
            <li><b>Complete Documentation</b>. There is a full&nbsp;<a
                    href="http://www.joda.org/joda-time/userguide.html" style="color: #000099; text-decoration: none;">User
                Guide</a>&nbsp;which provides an overview and covers common usage scenarios. The&nbsp;<a
                    href="http://www.joda.org/joda-time/apidocs/index.html"
                    style="color: #000099; text-decoration: none;">javadoc</a>&nbsp;is extremely detailed and covers the
                rest of the API.
            </li>
            <li><b>Maturity</b>. The library has been under active development since 2002. Although it continues to be
                improved with the addition of new features and bug-fixes, it is a mature and reliable code base. A
                number of&nbsp;<a href="http://www.joda.org/joda-time/related.html"
                                  style="color: #000099; text-decoration: none;">related projects</a>&nbsp;are now
                available.
            </li>
            <li><b>Open Source</b>. Joda-Time is licenced under the business friendly&nbsp;<a
                    href="http://www.joda.org/joda-time/license.html" style="color: #000099; text-decoration: none;">Apache
                License Version 2.0</a>.
            </li>
        </ul>
    </blockquote>
    <br/></div>
<div>Note that since Java 8, a <a href="http://java.dzone.com/articles/introducing-new-date-and-time">new Date and Time
    API</a> has been introduced in the JDK, and its creation involved the author of the Joda Time library.
</div>
